---
layout: wiki
title: Page Tables
wiki: MIT-6.S081
order: 24
---

### Page Tables

#### 检测被访问过的页面

* **背景**：一些垃圾回收机制如果能够获取页面是否被访问的信息，将能够提高效率。
* **目的**：实现检测页表访问位并将结果返回到用户态
* **预备知识**
  * RISC-V硬件处理TLB缺失时，将新的虚拟地址载入时，会将相应的页面访问位置位
* **任务**
  * 代码实现在`kernel/sysproc.c`中的`sys_pgaccess()`，参数如下
    * 第一个要检查的用户页面的虚拟地址
    * 将要检查页面的数量
    * 用于返回掩码结果的用户空间地址
  * 使用`argaddr()`和`argint()`解析参数
  * 最好在内核使用一个临时的缓冲区保存要输出的位掩码，利用`copyout()`输出
  * 可以设置扫描页面数量的上限
  * 使用`walk()`来找到正确的`PTE`
  * 需要在`kernel/riscv.h`中定义`PTE_A`
  * 确保检查`PTE_A`后，将其清零。否则无法判断在上次检查之后该页面有没有再次被访问
  * 使用`vmprint()`来帮助debug
* **代码**
